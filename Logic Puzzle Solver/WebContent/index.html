<!-- Gavin Vogt -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Logic Puzzle Solver</title>
<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

<h1>Logic Puzzle Solver</h1>

<div class="flexContainer">
<div class="setupDiv" id="setup">
<form onsubmit="solvePuzzle();return false;">
<button type="submit" class="solveButton">Solve</button>
<h2>Setup</h2>
Number of options per category: <input type="number" id="numOptions" value="4" min="2">
<hr>

<div id="categories">
<h3>Categories</h3>
</div>

<button type="button" class="actionButton" tabindex="-1" onclick="binding.addCategory();">Add Category</button>
<button type="button" class="actionButton" tabindex="-1" onclick="loadTable();">Update Puzzle</button>
<br>

<div class="conditionSection">
<h3>Conditions</h3>
<ol id="conditions">
  <li><div class="conditionContainer">
    THIS IS AN EXAMPLE (HARD-CODED) <br>
    Number of tests true must be <select><option>=</option>
      <option>!=</option>
      <option>&lt;</option>
      <option>&lt;=</option>
      <option>&gt;=</option>
      <option>&gt;=</option></select>
    <input type="number" value="1" min="0" style="width: 5em">
    <button type="button" class="categoryOption">Remove Condition</button>
    <hr>
    <div class="testContainer">
      <select>
        <option>Category 1</option>
        <option>Category 2</option>
        <option>Category 3</option>
      </select>
      <select>
        <option>Option 1</option>
        <option>Option 2</option>
        <option>Option 3</option>
      </select>
      <input maxlength="15" size="10" placeholder="any operations">
      <select>
        <option>is</option>
        <option>isn't</option>
        <option>=</option>
        <option>!=</option>
        <option>&lt;</option>
        <option>&lt;=</option>
        <option>&gt;=</option>
        <option>&gt;=</option>
      </select>
      <select>
        <option>Category 1</option>
        <option>Category 2</option>
        <option>Category 3</option>
      </select>
      <select>
        <option>Option 1</option>
        <option>Option 2</option>
        <option>Option 3</option>
      </select>
      <input maxlength="15" size="10" placeholder="any operations">
    <button type="button">Remove Test</button>
  </div>
  <div class="testContainer">
      <select>
        <option>Category 1</option>
        <option>Category 2</option>
        <option>Category 3</option>
      </select>
      <select>
        <option>Option 1</option>
        <option>Option 2</option>
        <option>Option 3</option>
      </select>
      <input maxlength="15" size="10" placeholder="any operations">
      <select>
        <option>is</option>
        <option>isn't</option>
        <option>=</option>
        <option>!=</option>
        <option>&lt;</option>
        <option>&lt;=</option>
        <option>&gt;=</option>
        <option>&gt;=</option>
      </select>
      <select>
        <option>Category 1</option>
        <option>Category 2</option>
        <option>Category 3</option>
      </select>
      <select>
        <option>Option 1</option>
        <option>Option 2</option>
        <option>Option 3</option>
      </select>
      <input maxlength="15" size="10" placeholder="any operations">
    <button type="button">Remove Test</button>
  </div>
  </div>
  </li>
</ol>
</div>


<button type="button" class="actionButton" tabindex="-1" onclick="binding.addCondition();">Add Condition</button>
<br>

<button type="submit" class="solveButton">Solve</button>
</form>
</div>

<div class="solutionDiv" id="solution">
<h2 class="solution">Solution</h2>
<table id="puzzle"></table>
</div>
</div>

<script type="text/javascript" src="solver.js"></script>
<script type="text/javascript" src="viewModel.js"></script>
<script>

var puzzle = new Puzzle();

// Track various counts
var numCategories = 4;

// Set up the View-Model
var binding = new ViewModel(puzzle);

// Set up the display
setUpInputs();
loadTable();

function setUpInputs() {
    for (var i = 0; i < numCategories; i++) {
        binding.addCategory();
    }
}

/**
 * Loads the user's inputs into the Puzzle object
 */
function loadInputs() {
    // Load the category / option information into the table
    for (var categoryId = 0; categoryId < numCategories; ++categoryId) {
        // Set the category name
        var catName = document.getElementById("catName" + categoryId);
        var category = puzzle.getCategory(categoryId);
        category.setName(catName.value);
        for (var optionId = 0; optionId < numOptions.value; ++optionId) {
            // Set the option names
            var optionInput = document.getElementById("option" + categoryId
                    + "," + optionId);
            var option = category.getOption(optionId);
            option.setName(optionInput.value);
        }
    }
}

function loadTable() {
    loadInputs();
    binding.updatePuzzleTable();
}

function solvePuzzle() {
    // Make sure the user's inputs are valid
    loadInputs();
    var validity = puzzle.validate();
    if (validity != null) {
        // Got an error message
        alert("Invalid input:\n" + validity);
        return;
    }
    
    // Solve the puzzle
    var solution = puzzle.solveBruteForce(); // array of Entities
    // TODO: how to present the solution
    if (solution == null) {
        alert("No solution found");
    } else {
        "<img src='images/selection_marker.png' alt='X' height='14px' width='14px'>";
        
        alert("Solved logic puzzle");
    }
}


</script>

</body>
</html>