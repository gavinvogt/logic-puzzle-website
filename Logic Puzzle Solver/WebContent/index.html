<!-- Gavin Vogt -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Logic Puzzle Solver</title>
<link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

<h1>Logic Puzzle Solver</h1>

<div class="flexContainer">
<div class="setupDiv" id="setup">
<form onsubmit="solvePuzzle();return false;">
<button type="submit" class="solveButton">Solve</button>
<h2>Setup</h2>
Number of options per category: <input type="number" id="numOptions" onchange="binding.updateNumOptions();" value="2" min="2">
<hr>

<div id="categories">
<h3>Categories</h3>
</div>

<button type="button" class="externalButton" tabindex="-1" onclick="binding.addCategory();loadTable();">Add Category</button>
<button type="button" class="externalButton" tabindex="-1" onclick="loadTable();">Update Puzzle</button>
<br>

<div class="conditionSection">
  <h3>Conditions</h3>
  <ol id="conditions"></ol>
</div>

<button type="button" class="externalButton" tabindex="-1" onclick="binding.addCondition();">Add Condition</button>
<br>

<button type="submit" class="solveButton">Solve</button>
</form>
</div>

<div class="solutionDiv" id="solution">
<h2 class="solution">Solution</h2>
<table id="puzzle"></table>
</div>
</div>

<script type="text/javascript" src="solver.js"></script>
<script type="text/javascript" src="viewModel.js"></script>
<script>

var puzzle = new Puzzle();

// Track various counts
var numCategories = 2;

// Set up the View-Model
var binding = new ViewModel(puzzle);

// Set up the display
setUpInputs();
loadTable();
binding.addCondition();   // start with a single condition

function setUpInputs() {
    for (var i = 0; i < numCategories; ++i) {
        binding.addCategory();
    }
}

function loadTable() {
    binding.loadNamingInputs();
    binding.updatePuzzleTable();
}

function solvePuzzle() {
    // Make sure the user's inputs are valid
    loadTable();
    var validity = puzzle.validate();
    if (validity != null) {
        // Got an error message
        alert("Invalid input:\n" + validity);
        return;
    }

    var conditions = binding.createConditions();
    console.log(conditions);

    // Solve the puzzle
    var solution = puzzle.solveBruteForce(conditions);  // array of Entities
    if (solution == null) {
        alert("No solution found");
    } else {
        // Display the solution on the graph
        solution.forEach(entity => {
            puzzle.getCategories().forEach(category => {
                let leftCatId = category.getId();
                let leftOptionId = entity.getAttribute(leftCatId).getId();
                puzzle.getCategories().forEach(otherCategory => {
                    let topCatId = otherCategory.getId();
                    if (leftCatId !== topCatId) {
                        // Valid coordinates - attempt to place marker
                        let topOptionId = entity.getAttribute(topCatId).getId();
                        let cellId = getCellId(leftCatId, leftOptionId, topCatId, topOptionId);
                        placeImage(cellId);
                    }
                });
            });
        });


        alert("Solved logic puzzle");
        console.log(solution);
    }
}

const IMAGE_HTML = "<img src='images/selection_marker.png' alt='X' height='14px' width='14px'>";
function placeImage(cellId) {
    let cell = document.getElementById(cellId);
    if (cell) {
        cell.innerHTML = IMAGE_HTML;
    }
}


</script>

</body>
</html>